<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a1512">
  <title>Productivity Engine</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-dark: #1a1512;
      --bg-rust: #2a1f1a;
      --bg-metal: #252019;
      --bg-panel: #1f1915;
      --rust-dark: #8b4513;
      --rust-medium: #a0522d;
      --rust-light: #cd853f;
      --rust-highlight: #daa520;
      --brass: #b8860b;
      --brass-light: #d4a537;
      --copper: #b87333;
      --copper-glow: #da8a47;
      --steel: #71797E;
      --steel-light: #a8a9ad;
      --text-primary: #e8dcc8;
      --text-secondary: #a89880;
      --text-muted: #6d5d4d;
      --accent-green: #4a7c59;
      --accent-green-glow: #5d9e6e;
      --accent-red: #8b3a3a;
      --accent-red-glow: #a94442;
      --accent-yellow: #b8860b;
      --rivet: #3d3429;
      --shadow-rust: rgba(139, 69, 19, 0.3);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-dark);
      background-image: 
        radial-gradient(ellipse at 20% 20%, rgba(139, 69, 19, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(184, 134, 11, 0.08) 0%, transparent 50%),
        url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
      color: var(--text-primary);
      min-height: 100vh;
      padding-bottom: 90px;
    }

    /* Login Screen */
    .login-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-dark);
      background-image: 
        radial-gradient(ellipse at 30% 30%, rgba(139, 69, 19, 0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 70%, rgba(184, 134, 11, 0.1) 0%, transparent 50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .login-screen.hidden {
      display: none;
    }

    .login-logo {
      font-size: 64px;
      margin-bottom: 20px;
      animation: rotate-slow 20s linear infinite;
      filter: drop-shadow(0 0 20px var(--copper-glow));
    }

    .login-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--brass-light);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 3px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    .login-subtitle {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 40px;
      font-family: 'Courier Prime', monospace;
      letter-spacing: 2px;
    }

    .login-box {
      background: var(--bg-panel);
      border: 1px solid var(--rust-dark);
      border-radius: 8px;
      padding: 32px;
      width: 90%;
      max-width: 320px;
      box-shadow: 0 0 40px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.05);
      position: relative;
    }

    .login-box::before,
    .login-box::after {
      content: '';
      position: absolute;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, var(--steel) 30%, var(--rivet) 70%);
      border-radius: 50%;
      top: 12px;
    }

    .login-box::before { left: 12px; }
    .login-box::after { right: 12px; }

    .login-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 12px;
      display: block;
      text-align: center;
    }

    .pin-input-container {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-bottom: 24px;
    }

    .pin-digit {
      width: 50px;
      height: 60px;
      background: var(--bg-dark);
      border: 2px solid var(--rust-medium);
      border-radius: 6px;
      font-size: 24px;
      font-family: 'Courier Prime', monospace;
      color: var(--brass-light);
      text-align: center;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
      transition: all 0.2s;
    }

    .pin-digit:focus {
      outline: none;
      border-color: var(--brass);
      box-shadow: 0 0 15px rgba(184, 134, 11, 0.3), inset 0 2px 4px rgba(0,0,0,0.3);
    }

    .pin-digit.filled {
      border-color: var(--accent-green);
    }

    .pin-digit.error {
      border-color: var(--accent-red);
      animation: shake 0.3s ease;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(180deg, var(--rust-medium) 0%, var(--rust-dark) 100%);
      border: 1px solid var(--rust-dark);
      border-radius: 4px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .login-btn:hover {
      background: linear-gradient(180deg, var(--rust-light) 0%, var(--rust-medium) 100%);
      box-shadow: 0 4px 15px rgba(139, 69, 19, 0.4);
    }

    .login-btn:active {
      transform: scale(0.98);
    }

    .login-error {
      color: var(--accent-red-glow);
      font-size: 12px;
      text-align: center;
      margin-top: 16px;
      font-family: 'Courier Prime', monospace;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .login-error.show {
      opacity: 1;
    }

    /* Main App - Hidden by default */
    .main-app {
      display: none;
    }

    .main-app.visible {
      display: block;
    }

    /* Gear decorations */
    .gear-bg {
      position: fixed;
      pointer-events: none;
      opacity: 0.03;
      z-index: 0;
    }

    .gear-bg.top-right {
      top: -50px;
      right: -50px;
      width: 200px;
      height: 200px;
      animation: rotate-slow 60s linear infinite;
    }

    .gear-bg.bottom-left {
      bottom: 50px;
      left: -80px;
      width: 250px;
      height: 250px;
      animation: rotate-slow 80s linear infinite reverse;
    }

    @keyframes rotate-slow {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Header */
    .header {
      padding: 20px 16px 16px;
      background: linear-gradient(180deg, var(--bg-rust) 0%, var(--bg-dark) 100%);
      border-bottom: 2px solid var(--rust-dark);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5), inset 0 1px 0 rgba(218, 165, 32, 0.1);
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--brass), transparent);
    }

    .greeting {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 4px;
      color: var(--text-primary);
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .greeting-icon {
      font-size: 20px;
      filter: drop-shadow(0 0 8px var(--copper-glow));
    }

    .date-info {
      color: var(--text-secondary);
      font-size: 13px;
      font-family: 'Courier Prime', monospace;
      letter-spacing: 1px;
    }

    .sprint-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-metal);
      padding: 8px 14px;
      border-radius: 4px;
      font-size: 13px;
      margin-top: 12px;
      border: 1px solid var(--rust-dark);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.05), 0 2px 8px rgba(0,0,0,0.3);
    }

    .sprint-badge::before {
      content: '‚öô';
      font-size: 14px;
      color: var(--brass);
      animation: rotate-slow 10s linear infinite;
      display: inline-block;
    }

    .sprint-badge .days {
      color: var(--accent-green-glow);
      font-weight: 600;
      font-family: 'Courier Prime', monospace;
    }

    .sprint-badge .days.warning {
      color: var(--accent-yellow);
    }

    .sprint-badge .days.urgent {
      color: var(--accent-red-glow);
    }

    /* Stats bar */
    .stats-bar {
      display: flex;
      gap: 8px;
      padding: 12px 16px;
      margin: 16px 16px;
      background: var(--bg-panel);
      border-radius: 6px;
      border: 1px solid var(--rust-dark);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 1px 0 rgba(255,255,255,0.02);
    }

    .stat-item {
      flex: 1;
      text-align: center;
      padding: 8px 4px;
      background: var(--bg-metal);
      border-radius: 4px;
      border: 1px solid var(--rivet);
      position: relative;
    }

    .stat-item::before,
    .stat-item::after {
      content: '';
      position: absolute;
      width: 6px;
      height: 6px;
      background: radial-gradient(circle, var(--steel) 30%, var(--rivet) 70%);
      border-radius: 50%;
      top: 4px;
    }

    .stat-item::before { left: 4px; }
    .stat-item::after { right: 4px; }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--brass-light);
      font-family: 'Courier Prime', monospace;
      text-shadow: 0 0 10px rgba(218, 165, 32, 0.3);
    }

    .stat-label {
      font-size: 10px;
      color: var(--text-muted);
      margin-top: 2px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Navigation */
    .nav-tabs {
      display: flex;
      gap: 4px;
      padding: 0 16px;
      margin-bottom: 16px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .nav-tab {
      padding: 10px 16px;
      border-radius: 4px 4px 0 0;
      background: var(--bg-metal);
      border: 1px solid var(--rust-dark);
      border-bottom: none;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      position: relative;
    }

    .nav-tab:hover {
      background: var(--bg-rust);
      color: var(--text-primary);
    }

    .nav-tab.active {
      background: var(--bg-panel);
      color: var(--brass-light);
      border-color: var(--brass);
      box-shadow: 0 -2px 10px rgba(218, 165, 32, 0.2);
    }

    .nav-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--bg-panel);
    }

    /* Sections */
    .section {
      padding: 0 16px;
      margin-bottom: 24px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .section-count {
      background: var(--bg-metal);
      padding: 2px 10px;
      border-radius: 10px;
      font-size: 12px;
      color: var(--brass);
      font-family: 'Courier Prime', monospace;
      border: 1px solid var(--rust-dark);
    }

    /* Cards and Panels */
    .card {
      background: var(--bg-panel);
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid var(--rust-dark);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.03), 0 4px 12px rgba(0,0,0,0.3);
      position: relative;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 8px;
      left: 8px;
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, var(--steel) 20%, var(--rivet) 60%, transparent 70%);
      border-radius: 50%;
    }

    .card::after {
      content: '';
      position: absolute;
      top: 8px;
      right: 8px;
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, var(--steel) 20%, var(--rivet) 60%, transparent 70%);
      border-radius: 50%;
    }

    /* Task Items */
    .task-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 14px;
      background: var(--bg-metal);
      border-radius: 4px;
      margin-bottom: 8px;
      border: 1px solid var(--rivet);
      transition: all 0.2s;
      position: relative;
    }

    .task-item:hover {
      border-color: var(--rust-medium);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .task-item:active {
      transform: scale(0.99);
    }

    .task-item.in-sprint {
      border-left: 3px solid var(--copper);
      background: linear-gradient(90deg, rgba(184, 115, 51, 0.1) 0%, var(--bg-metal) 30%);
    }

    .task-checkbox {
      width: 32px;
      height: 32px;
      border-radius: 4px;
      border: 2px solid var(--rust-medium);
      background: var(--bg-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: var(--rust-light);
      cursor: pointer;
      flex-shrink: 0;
      transition: all 0.2s;
      font-family: 'Courier Prime', monospace;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }

    .task-checkbox:hover {
      border-color: var(--accent-green);
      color: var(--accent-green-glow);
      box-shadow: 0 0 10px rgba(74, 124, 89, 0.3), inset 0 2px 4px rgba(0,0,0,0.3);
    }

    .task-checkbox.completing {
      background: var(--accent-green);
      border-color: var(--accent-green);
      color: var(--text-primary);
      box-shadow: 0 0 15px rgba(74, 124, 89, 0.5);
    }

    .task-content {
      flex: 1;
      min-width: 0;
    }

    .task-text {
      font-size: 14px;
      line-height: 1.5;
      word-wrap: break-word;
      color: var(--text-primary);
    }

    .task-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .task-due {
      font-size: 11px;
      color: var(--accent-yellow);
      font-family: 'Courier Prime', monospace;
    }

    .task-due.overdue {
      color: var(--accent-red-glow);
    }

    .task-category {
      font-size: 10px;
      color: var(--text-muted);
      background: var(--bg-dark);
      padding: 2px 8px;
      border-radius: 2px;
      border: 1px solid var(--rivet);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .task-objective {
      font-size: 10px;
      color: var(--copper-glow);
      background: rgba(184, 115, 51, 0.15);
      padding: 2px 8px;
      border-radius: 2px;
      border: 1px solid rgba(184, 115, 51, 0.3);
    }

    /* Progress bars */
    .progress-bar {
      height: 8px;
      background: var(--bg-dark);
      border-radius: 2px;
      overflow: hidden;
      border: 1px solid var(--rivet);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.4);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-green) 0%, var(--accent-green-glow) 100%);
      border-radius: 2px;
      transition: width 0.3s ease;
      box-shadow: 0 0 10px rgba(74, 124, 89, 0.4);
    }

    .progress-fill.warning {
      background: linear-gradient(90deg, var(--accent-yellow) 0%, var(--brass-light) 100%);
      box-shadow: 0 0 10px rgba(184, 134, 11, 0.4);
    }

    .progress-fill.danger {
      background: linear-gradient(90deg, var(--accent-red) 0%, var(--accent-red-glow) 100%);
      box-shadow: 0 0 10px rgba(139, 58, 58, 0.4);
    }

    /* Objectives */
    .objective-item {
      margin-bottom: 16px;
      padding: 12px;
      background: var(--bg-metal);
      border-radius: 4px;
      border: 1px solid var(--rivet);
    }

    .objective-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .objective-status {
      font-size: 16px;
      margin-right: 10px;
      filter: drop-shadow(0 0 4px var(--copper-glow));
    }

    .objective-statement {
      font-size: 14px;
      color: var(--text-primary);
      flex: 1;
    }

    .objective-progress {
      font-size: 13px;
      color: var(--brass);
      font-weight: 600;
      font-family: 'Courier Prime', monospace;
    }

    /* Launch cards */
    .launch-card {
      background: var(--bg-panel);
      border-radius: 4px;
      padding: 14px;
      margin-bottom: 10px;
      border: 1px solid var(--rust-dark);
      position: relative;
    }

    .launch-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .launch-title {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-primary);
    }

    .launch-badge {
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 2px;
      background: var(--bg-metal);
      color: var(--brass);
      font-family: 'Courier Prime', monospace;
      border: 1px solid var(--rust-dark);
    }

    .launch-badge.stalled {
      background: rgba(139, 58, 58, 0.2);
      color: var(--accent-red-glow);
      border-color: var(--accent-red);
    }

    .launch-phase {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 8px;
      font-family: 'Courier Prime', monospace;
    }

    /* Incoming section */
    .incoming-section {
      background: rgba(184, 134, 11, 0.08);
      border: 1px solid var(--brass);
      border-radius: 4px;
      padding: 16px;
      margin: 0 16px 24px;
      box-shadow: 0 0 20px rgba(184, 134, 11, 0.1);
    }

    .incoming-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: var(--bg-metal);
      border-radius: 4px;
      margin-top: 12px;
      border: 1px solid var(--rivet);
    }

    .incoming-from {
      font-size: 11px;
      color: var(--text-muted);
      font-family: 'Courier Prime', monospace;
    }

    /* Buttons */
    .btn {
      padding: 10px 18px;
      border-radius: 4px;
      border: 1px solid var(--rust-dark);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn-primary {
      background: linear-gradient(180deg, var(--accent-green-glow) 0%, var(--accent-green) 100%);
      color: var(--text-primary);
      border-color: var(--accent-green);
      box-shadow: 0 2px 8px rgba(74, 124, 89, 0.3);
    }

    .btn-primary:hover {
      box-shadow: 0 4px 15px rgba(74, 124, 89, 0.5);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--bg-metal);
      color: var(--text-secondary);
    }

    .btn-secondary:hover {
      background: var(--bg-rust);
      color: var(--text-primary);
    }

    /* Quick actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .quick-action {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 24px 12px;
      background: var(--bg-panel);
      border-radius: 6px;
      border: 1px solid var(--rust-dark);
      color: var(--text-primary);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .quick-action:hover {
      border-color: var(--brass);
      box-shadow: 0 0 15px rgba(184, 134, 11, 0.2);
    }

    .quick-action:active {
      transform: scale(0.97);
    }

    .quick-action-icon {
      font-size: 28px;
      filter: drop-shadow(0 0 8px var(--copper-glow));
    }

    /* Bottom bar */
    .bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-rust);
      border-top: 2px solid var(--rust-dark);
      padding: 12px 16px;
      padding-bottom: max(12px, env(safe-area-inset-bottom));
      box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
    }

    .bottom-bar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--brass), transparent);
    }

    .command-input {
      width: 100%;
      background: var(--bg-dark);
      border: 1px solid var(--rust-medium);
      border-radius: 4px;
      padding: 14px 16px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: 'Courier Prime', monospace;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }

    .command-input::placeholder {
      color: var(--text-muted);
    }

    .command-input:focus {
      outline: none;
      border-color: var(--brass);
      box-shadow: 0 0 10px rgba(184, 134, 11, 0.2), inset 0 2px 4px rgba(0,0,0,0.3);
    }

    /* Loading and states */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--rivet);
      border-top-color: var(--brass);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 12px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 12px;
      filter: grayscale(0.5);
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-panel);
      border: 1px solid var(--brass);
      padding: 12px 24px;
      border-radius: 4px;
      font-size: 14px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5), 0 0 20px rgba(184, 134, 11, 0.2);
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .toast.show {
      opacity: 1;
    }

    .toast.success {
      border-color: var(--accent-green);
      box-shadow: 0 4px 20px rgba(0,0,0,0.5), 0 0 20px rgba(74, 124, 89, 0.3);
    }

    /* Tab content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Settings */
    .settings-panel {
      padding: 16px;
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: var(--bg-panel);
      border-radius: 4px;
      margin-bottom: 10px;
      border: 1px solid var(--rust-dark);
    }

    .setting-label {
      font-size: 13px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .setting-input {
      background: var(--bg-dark);
      border: 1px solid var(--rust-medium);
      border-radius: 4px;
      padding: 10px 12px;
      color: var(--text-primary);
      font-size: 14px;
      width: 200px;
      font-family: 'Courier Prime', monospace;
    }

    .setting-input:focus {
      outline: none;
      border-color: var(--brass);
    }

    /* Modals */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-panel);
      border-radius: 6px;
      width: 90%;
      max-width: 400px;
      max-height: 80vh;
      overflow-y: auto;
      border: 1px solid var(--rust-dark);
      box-shadow: 0 0 40px rgba(0,0,0,0.8), 0 0 20px rgba(184, 134, 11, 0.1);
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid var(--rust-dark);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--bg-rust);
    }

    .modal-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--brass-light);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 24px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: var(--text-primary);
    }

    .modal-body {
      padding: 20px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .form-input, .form-textarea {
      width: 100%;
      background: var(--bg-dark);
      border: 1px solid var(--rust-medium);
      border-radius: 4px;
      padding: 12px;
      color: var(--text-primary);
      font-size: 14px;
    }

    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--brass);
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
      font-family: inherit;
    }

    .modal-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--rust-dark);
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      background: var(--bg-metal);
    }

    /* Backlog */
    .backlog-category {
      margin-bottom: 20px;
    }

    .backlog-category-header {
      font-size: 12px;
      font-weight: 600;
      color: var(--rust-light);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .backlog-category-count {
      background: var(--bg-metal);
      padding: 2px 8px;
      border-radius: 2px;
      font-size: 11px;
      color: var(--brass);
      font-family: 'Courier Prime', monospace;
      border: 1px solid var(--rivet);
    }

    /* Checkbox label */
    .form-group label {
      color: var(--text-secondary);
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-group input[type="checkbox"] {
      accent-color: var(--brass);
    }

    /* Gear SVG */
    .gear-svg {
      fill: var(--rust-medium);
    }
  </style>
</head>
<body>

  <!-- LOGIN SCREEN -->
  <div class="login-screen" id="loginScreen">
    <div class="login-logo">‚öôÔ∏è</div>
    <div class="login-title">Productivity Engine</div>
    <div class="login-subtitle">AUTHENTICATION REQUIRED</div>
    
    <div class="login-box">
      <label class="login-label">Enter Access Code</label>
      <div class="pin-input-container">
        <input type="password" class="pin-digit" maxlength="1" data-index="0" inputmode="numeric">
        <input type="password" class="pin-digit" maxlength="1" data-index="1" inputmode="numeric">
        <input type="password" class="pin-digit" maxlength="1" data-index="2" inputmode="numeric">
        <input type="password" class="pin-digit" maxlength="1" data-index="3" inputmode="numeric">
      </div>
      <button class="login-btn" onclick="attemptLogin()">Initialize</button>
      <div class="login-error" id="loginError">ACCESS DENIED - INVALID CODE</div>
    </div>
  </div>

  <!-- MAIN APP (hidden until login) -->
  <div class="main-app" id="mainApp">
    <!-- Decorative gears -->
    <svg class="gear-bg top-right" viewBox="0 0 100 100">
      <path class="gear-svg" d="M50 10 L54 10 L56 20 L60 22 L68 14 L72 18 L64 26 L66 30 L76 32 L76 36 L66 38 L64 42 L72 50 L68 54 L60 46 L56 48 L54 58 L50 58 L48 48 L44 46 L36 54 L32 50 L40 42 L38 38 L28 36 L28 32 L38 30 L40 26 L32 18 L36 14 L44 22 L48 20 Z M50 35 A15 15 0 1 0 50 65 A15 15 0 1 0 50 35"/>
    </svg>
    
    <svg class="gear-bg bottom-left" viewBox="0 0 100 100">
      <path class="gear-svg" d="M50 5 L55 5 L57 18 L63 21 L74 11 L79 16 L69 27 L72 33 L85 35 L85 40 L72 42 L69 48 L79 59 L74 64 L63 54 L57 57 L55 70 L50 70 L48 57 L42 54 L31 64 L26 59 L36 48 L33 42 L20 40 L20 35 L33 33 L36 27 L26 16 L31 11 L42 21 L48 18 Z M50 32 A18 18 0 1 0 50 68 A18 18 0 1 0 50 32"/>
    </svg>

    <header class="header">
      <div class="greeting" id="greeting">
        <span class="greeting-icon">‚öôÔ∏è</span>
        <span>Good Morning</span>
      </div>
      <div class="date-info" id="dateInfo">LOADING SYSTEMS...</div>
      <div class="sprint-badge" id="sprintBadge" style="display: none;">
        <span id="sprintName">Sprint</span> ‚Ä¢ <span class="days" id="sprintDays">0</span> cycles remaining
      </div>
    </header>

    <div class="stats-bar" id="statsBar" style="display: none;">
      <div class="stat-item">
        <div class="stat-value" id="statActive">0</div>
        <div class="stat-label">Active</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="statSprint">0</div>
        <div class="stat-label">Sprint</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="statOverdue">0</div>
        <div class="stat-label">Overdue</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="statTotal">0</div>
        <div class="stat-label">Total</div>
      </div>
    </div>

    <nav class="nav-tabs">
      <button class="nav-tab active" data-tab="today">Today</button>
      <button class="nav-tab" data-tab="sprint">Sprint</button>
      <button class="nav-tab" data-tab="backlog">Backlog</button>
      <button class="nav-tab" data-tab="launches">Launches</button>
      <button class="nav-tab" data-tab="actions">Tools</button>
      <button class="nav-tab" data-tab="settings">‚öôÔ∏è</button>
    </nav>

    <div class="tab-content active" id="tab-today">
      <div class="incoming-section" id="incomingSection" style="display: none;">
        <div class="section-title">üì• Incoming Transmission</div>
        <div id="incomingList"></div>
      </div>

      <section class="section">
        <div class="section-header">
          <div class="section-title">üéØ Active Operations <span class="section-count" id="activeCount">0</span></div>
        </div>
        <div id="activeTasks">
          <div class="loading"><div class="spinner"></div> Initializing...</div>
        </div>
      </section>

      <section class="section">
        <div class="section-header">
          <div class="section-title">‚ö†Ô∏è Overdue <span class="section-count" id="overdueCount">0</span></div>
        </div>
        <div id="overdueTasks"></div>
      </section>

      <section class="section">
        <div class="section-header">
          <div class="section-title">üöÄ Launch Status</div>
        </div>
        <div id="launchesPreview"></div>
      </section>
    </div>

    <div class="tab-content" id="tab-sprint">
      <section class="section" id="sprintSection">
        <div id="sprintContent">
          <div class="empty-state">
            <div class="empty-state-icon">‚öôÔ∏è</div>
            <div>No active sprint cycle</div>
            <div style="font-size: 12px; margin-top: 8px; color: var(--text-muted);">Initialize with "let's build a sprint"</div>
          </div>
        </div>
      </section>
    </div>

    <div class="tab-content" id="tab-backlog">
      <section class="section">
        <div class="section-header">
          <div class="section-title">üìã Task Queue</div>
        </div>
        <div id="backlogContent">
          <div class="loading"><div class="spinner"></div> Loading queue...</div>
        </div>
      </section>
    </div>

    <div class="tab-content" id="tab-launches">
      <section class="section">
        <div class="section-header">
          <div class="section-title">üöÄ All Launches</div>
        </div>
        <div id="allLaunches">
          <div class="loading"><div class="spinner"></div> Loading...</div>
        </div>
      </section>
    </div>

    <div class="tab-content" id="tab-actions">
      <section class="section">
        <div class="quick-actions">
          <button class="quick-action" onclick="openAddTaskModal()">
            <span class="quick-action-icon">‚ûï</span>
            New Task
          </button>
          <button class="quick-action" onclick="openJournalModal()">
            <span class="quick-action-icon">üìù</span>
            Log Entry
          </button>
          <button class="quick-action" onclick="openIdeaModal()">
            <span class="quick-action-icon">üí°</span>
            Capture
          </button>
          <button class="quick-action" onclick="refreshData()">
            <span class="quick-action-icon">üîÑ</span>
            Refresh
          </button>
        </div>
      </section>
    </div>

    <div class="tab-content" id="tab-settings">
      <div class="settings-panel">
        <div class="setting-item">
          <span class="setting-label">API Endpoint</span>
          <input type="text" class="setting-input" id="apiUrl" placeholder="https://...">
        </div>
        <div class="setting-item">
          <button class="btn btn-primary" onclick="saveSettings()">Save Config</button>
        </div>
        <div class="setting-item">
          <button class="btn btn-secondary" onclick="logout()">Logout</button>
        </div>
      </div>
    </div>

    <div class="bottom-bar">
      <input type="text" class="command-input" id="commandInput" placeholder="> Enter command (e.g., '1 done')">
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- Modals -->
  <div class="modal-overlay" id="addTaskModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">New Task</div>
        <button class="modal-close" onclick="closeModal('addTaskModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Task Description</label>
          <input type="text" class="form-input" id="newTaskText" placeholder="What needs to be done?">
        </div>
        <div class="form-group">
          <label class="form-label">Category</label>
          <input type="text" class="form-input" id="newTaskCategory" placeholder="General">
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="newTaskActive"> Add to active queue
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('addTaskModal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitNewTask()">Create</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="journalModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">üìù Log Entry</div>
        <button class="modal-close" onclick="closeModal('journalModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Entry</label>
          <textarea class="form-textarea" id="journalContent" placeholder="Record your thoughts..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <select class="form-input" id="journalMood">
            <option value="">Select...</option>
            <option value="focused">Focused</option>
            <option value="calm">Calm</option>
            <option value="excited">Excited</option>
            <option value="frustrated">Frustrated</option>
            <option value="anxious">Anxious</option>
            <option value="grateful">Grateful</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('journalModal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitJournal()">Save</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="ideaModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">üí° Capture Idea</div>
        <button class="modal-close" onclick="closeModal('ideaModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Title</label>
          <input type="text" class="form-input" id="ideaTitle" placeholder="Quick title...">
        </div>
        <div class="form-group">
          <label class="form-label">Details</label>
          <textarea class="form-textarea" id="ideaContent" placeholder="Expand on the idea..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('ideaModal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitIdea()">Capture</button>
      </div>
    </div>
  </div>

  <script>
    // Configuration
    const API_BASE = 'https://productivity-mcp-server.micaiah-tasks.workers.dev';
    const VALID_PINS = {
      '1987': 'micaiah',
      '1976': 'irene'
    };

    let API_URL = '';
    let API_KEY = '';
    let currentUser = '';

    // Check if already logged in
    function checkSession() {
      const session = localStorage.getItem('dashboardSession');
      if (session) {
        const { pin, timestamp } = JSON.parse(session);
        // Session valid for 7 days
        if (Date.now() - timestamp < 7 * 24 * 60 * 60 * 1000 && VALID_PINS[pin]) {
          currentUser = VALID_PINS[pin];
          API_KEY = pin;
          API_URL = API_BASE;
          showMainApp();
          return true;
        }
      }
      return false;
    }

    // PIN input handling
    const pinInputs = document.querySelectorAll('.pin-digit');
    pinInputs.forEach((input, index) => {
      input.addEventListener('input', (e) => {
        const value = e.target.value;
        if (value && index < 3) {
          pinInputs[index + 1].focus();
        }
        if (value) {
          input.classList.add('filled');
        } else {
          input.classList.remove('filled');
        }
      });

      input.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && !e.target.value && index > 0) {
          pinInputs[index - 1].focus();
        }
        if (e.key === 'Enter') {
          attemptLogin();
        }
      });
    });

    function attemptLogin() {
      const pin = Array.from(pinInputs).map(i => i.value).join('');
      
      if (VALID_PINS[pin]) {
        currentUser = VALID_PINS[pin];
        API_KEY = pin;
        API_URL = API_BASE;
        
        // Save session
        localStorage.setItem('dashboardSession', JSON.stringify({
          pin: pin,
          timestamp: Date.now()
        }));
        
        showMainApp();
      } else {
        // Show error
        document.getElementById('loginError').classList.add('show');
        pinInputs.forEach(input => {
          input.classList.add('error');
          input.value = '';
        });
        pinInputs[0].focus();
        
        setTimeout(() => {
          document.getElementById('loginError').classList.remove('show');
          pinInputs.forEach(input => input.classList.remove('error'));
        }, 2000);
      }
    }

    function showMainApp() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainApp').classList.add('visible');
      document.getElementById('apiUrl').value = API_URL;
      loadMorningData();
    }

    function logout() {
      localStorage.removeItem('dashboardSession');
      location.reload();
    }

    async function api(endpoint, options = {}) {
      if (!API_URL) {
        showToast('Not configured', 'error');
        return null;
      }

      const headers = { 'Content-Type': 'application/json' };
      if (API_KEY) headers['Authorization'] = `Bearer ${API_KEY}`;

      try {
        const response = await fetch(`${API_URL}${endpoint}`, { ...options, headers: { ...headers, ...options.headers } });
        if (!response.ok) throw new Error(`API error: ${response.status}`);
        return await response.json();
      } catch (error) {
        console.error('API Error:', error);
        showToast('Connection failed', 'error');
        return null;
      }
    }

    let currentData = null;

    async function loadMorningData() {
      const data = await api('/morning');
      if (!data) return;

      currentData = data;

      document.getElementById('greeting').innerHTML = `<span class="greeting-icon">‚öôÔ∏è</span><span>Good ${getTimeOfDay()}</span>`;
      document.getElementById('dateInfo').textContent = `${data.greeting.dayOfWeek.toUpperCase()} // ${data.greeting.date}`;

      if (data.sprint) {
        document.getElementById('sprintBadge').style.display = 'inline-flex';
        document.getElementById('sprintName').textContent = data.sprint.name;
        const daysEl = document.getElementById('sprintDays');
        daysEl.textContent = data.sprint.daysRemaining;
        daysEl.className = 'days' + (data.sprint.daysRemaining <= 3 ? ' urgent' : data.sprint.daysRemaining <= 7 ? ' warning' : '');
      } else {
        document.getElementById('sprintBadge').style.display = 'none';
      }

      if (data.stats) {
        document.getElementById('statsBar').style.display = 'flex';
        document.getElementById('statActive').textContent = data.stats.activeTasks || 0;
        document.getElementById('statSprint').textContent = data.stats.sprintTasks || 0;
        document.getElementById('statOverdue').textContent = data.stats.overdue || 0;
        document.getElementById('statTotal').textContent = data.stats.totalTasks || 0;
      }

      if (data.incoming && data.incoming.length > 0) {
        document.getElementById('incomingSection').style.display = 'block';
        renderIncoming(data.incoming);
      } else {
        document.getElementById('incomingSection').style.display = 'none';
      }

      renderActiveTasks(data.activeTasks || []);
      renderOverdueTasks(data.overdueTasks || []);
      renderSprintContent(data.sprint);
      renderBacklog(data.backlogByCategory || {});
      renderLaunchesPreview(data.launches || []);
    }

    function renderActiveTasks(tasks) {
      const container = document.getElementById('activeTasks');
      document.getElementById('activeCount').textContent = tasks.length;

      if (tasks.length === 0) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ú®</div><div>No active operations</div></div>`;
        return;
      }

      container.innerHTML = tasks.map((task, index) => `
        <div class="task-item ${task.objective_id ? 'in-sprint' : ''}" data-id="${task.id}">
          <div class="task-checkbox" onclick="completeTask('${task.id}', this)">${String(index + 1).padStart(2, '0')}</div>
          <div class="task-content">
            <div class="task-text">${escapeHtml(task.text)}</div>
            <div class="task-meta">
              ${task.due_date ? `<span class="task-due ${isOverdue(task.due_date) ? 'overdue' : ''}">${formatDate(task.due_date)}</span>` : ''}
              ${task.category ? `<span class="task-category">${escapeHtml(task.category)}</span>` : ''}
              ${task.objective_statement ? `<span class="task-objective">‚Üí ${escapeHtml(task.objective_statement)}</span>` : ''}
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderOverdueTasks(tasks) {
      const container = document.getElementById('overdueTasks');
      document.getElementById('overdueCount').textContent = tasks.length;

      if (tasks.length === 0) {
        container.innerHTML = `<div style="color: var(--text-muted); font-size: 13px; padding: 12px; font-family: 'Courier Prime', monospace;">ALL CLEAR ‚úì</div>`;
        return;
      }

      container.innerHTML = tasks.map(task => `
        <div class="task-item" data-id="${task.id}">
          <div class="task-checkbox" onclick="completeTask('${task.id}', this)" style="border-color: var(--accent-red); color: var(--accent-red-glow);">!</div>
          <div class="task-content">
            <div class="task-text">${escapeHtml(task.text)}</div>
            <div class="task-meta">
              <span class="task-due overdue">${formatDate(task.due_date)}</span>
              ${task.category ? `<span class="task-category">${escapeHtml(task.category)}</span>` : ''}
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderSprintContent(sprint) {
      const container = document.getElementById('sprintContent');

      if (!sprint) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚öôÔ∏è</div><div>No active sprint cycle</div><div style="font-size: 12px; margin-top: 8px; color: var(--text-muted);">Initialize with "let's build a sprint"</div></div>`;
        return;
      }

      const objectives = sprint.objectives || [];
      let totalTasks = 0, completedTasks = 0;
      objectives.forEach(obj => { totalTasks += obj.totalTasks || 0; completedTasks += obj.doneTasks || 0; });
      const progressPct = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

      let html = `
        <div class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-left: 20px;">
            <div style="font-weight: 600; color: var(--brass-light); font-size: 15px;">${escapeHtml(sprint.name)}</div>
            <div style="font-size: 12px; color: var(--text-muted); font-family: 'Courier Prime', monospace;">${sprint.daysRemaining} DAYS</div>
          </div>
          <div class="progress-bar" style="margin-bottom: 10px;">
            <div class="progress-fill ${progressPct < 30 ? 'danger' : progressPct < 70 ? 'warning' : ''}" style="width: ${progressPct}%"></div>
          </div>
          <div style="font-size: 12px; color: var(--text-muted); font-family: 'Courier Prime', monospace;">${completedTasks}/${totalTasks} TASKS // ${progressPct}%</div>
        </div>
      `;

      if (objectives.length > 0) {
        html += objectives.map(obj => {
          const objTotal = obj.totalTasks || 0;
          const objDone = obj.doneTasks || 0;
          const icon = objDone === objTotal && objTotal > 0 ? '‚úÖ' : objDone > 0 ? '‚óê' : '‚óã';
          return `
            <div class="objective-item">
              <div class="objective-header">
                <span class="objective-status">${icon}</span>
                <span class="objective-statement">${escapeHtml(obj.statement)}</span>
                <span class="objective-progress">${objDone}/${objTotal}</span>
              </div>
            </div>
          `;
        }).join('');
      }

      container.innerHTML = html;
    }

    function renderBacklog(backlogByCategory) {
      const container = document.getElementById('backlogContent');
      const categories = Object.keys(backlogByCategory);

      if (categories.length === 0) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üìã</div><div>Queue empty</div></div>`;
        return;
      }

      container.innerHTML = categories.map(cat => {
        const tasks = backlogByCategory[cat];
        return `
          <div class="backlog-category">
            <div class="backlog-category-header">
              ${escapeHtml(cat)} <span class="backlog-category-count">${tasks.length}</span>
            </div>
            ${tasks.slice(0, 5).map(task => `
              <div class="task-item" data-id="${task.id}">
                <div class="task-checkbox" onclick="activateTask('${task.id}', this)" style="font-size: 16px;">+</div>
                <div class="task-content">
                  <div class="task-text">${escapeHtml(task.text)}</div>
                  ${task.due_date ? `<div class="task-meta"><span class="task-due">${formatDate(task.due_date)}</span></div>` : ''}
                </div>
              </div>
            `).join('')}
            ${tasks.length > 5 ? `<div style="font-size: 11px; color: var(--text-muted); padding: 8px; font-family: 'Courier Prime', monospace;">+${tasks.length - 5} MORE</div>` : ''}
          </div>
        `;
      }).join('');
    }

    function renderLaunchesPreview(launches) {
      const container = document.getElementById('launchesPreview');

      if (launches.length === 0) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üöÄ</div><div>No active launches</div></div>`;
        return;
      }

      container.innerHTML = launches.slice(0, 3).map(launch => `
        <div class="launch-card">
          <div class="launch-header">
            <span class="launch-title">${escapeHtml(launch.title)}</span>
            ${launch.progress === 0 ? '<span class="launch-badge stalled">‚ö†Ô∏è STALLED</span>' : `<span class="launch-badge">${launch.progress}%</span>`}
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${launch.progress}%"></div>
          </div>
          <div class="launch-phase">${escapeHtml(launch.phase || 'NO PHASE')}</div>
        </div>
      `).join('');
    }

    async function loadAllLaunches() {
      const data = await api('/launches');
      if (!data) return;

      const container = document.getElementById('allLaunches');
      const launches = data.launches || [];

      if (launches.length === 0) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üöÄ</div><div>No launches</div></div>`;
        return;
      }

      container.innerHTML = launches.map(launch => `
        <div class="launch-card">
          <div class="launch-header">
            <span class="launch-title">${escapeHtml(launch.title)}</span>
            <span class="launch-badge">${launch.progress}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${launch.progress}%"></div>
          </div>
          <div class="launch-phase">${escapeHtml(launch.phase || '')} // ${launch.completed}/${launch.total} ITEMS</div>
        </div>
      `).join('');
    }

    function renderIncoming(items) {
      const container = document.getElementById('incomingList');
      container.innerHTML = items.map(item => `
        <div class="incoming-item">
          <div>
            <div style="color: var(--text-primary);">${escapeHtml(item.text || item.task_text)}</div>
            <div class="incoming-from">FROM: ${escapeHtml(item.from_user).toUpperCase()}</div>
          </div>
          <div><button class="btn btn-primary" onclick="claimTask('${item.id}')">Claim</button></div>
        </div>
      `).join('');
    }

    async function completeTask(id, element) {
      element.classList.add('completing');
      element.textContent = '‚úì';

      const result = await api(`/tasks/${id}/complete`, { method: 'POST' });

      if (result && result.success) {
        showToast('Task completed ‚úì');
        setTimeout(() => {
          element.closest('.task-item').style.opacity = '0';
          setTimeout(() => refreshData(), 300);
        }, 500);
      } else {
        element.classList.remove('completing');
      }
    }

    async function activateTask(id, element) {
      const result = await api(`/tasks/${id}/activate`, { method: 'POST' });
      if (result && result.success) {
        showToast('Task activated');
        refreshData();
      }
    }

    async function claimTask(id) {
      const result = await api(`/tasks/${id}/activate`, { method: 'POST' });
      if (result && result.success) {
        showToast('Task claimed');
        refreshData();
      }
    }

    async function submitNewTask() {
      const text = document.getElementById('newTaskText').value.trim();
      const category = document.getElementById('newTaskCategory').value.trim() || 'General';
      const isActive = document.getElementById('newTaskActive').checked;

      if (!text) { showToast('Enter task description', 'error'); return; }

      const result = await api('/tasks', { method: 'POST', body: JSON.stringify({ text, category, isActive }) });

      if (result && result.success) {
        showToast('Task created');
        closeModal('addTaskModal');
        document.getElementById('newTaskText').value = '';
        document.getElementById('newTaskCategory').value = '';
        document.getElementById('newTaskActive').checked = false;
        refreshData();
      }
    }

    async function submitJournal() {
      const content = document.getElementById('journalContent').value.trim();
      const mood = document.getElementById('journalMood').value;

      if (!content) { showToast('Enter content', 'error'); return; }

      const result = await api('/journal', { method: 'POST', body: JSON.stringify({ content, mood }) });

      if (result && result.success) {
        showToast('Entry logged');
        closeModal('journalModal');
        document.getElementById('journalContent').value = '';
        document.getElementById('journalMood').value = '';
      }
    }

    async function submitIdea() {
      const title = document.getElementById('ideaTitle').value.trim();
      const content = document.getElementById('ideaContent').value.trim();

      if (!title) { showToast('Enter title', 'error'); return; }

      const result = await api('/ideas', { method: 'POST', body: JSON.stringify({ title, content }) });

      if (result && result.success) {
        showToast('Idea captured');
        closeModal('ideaModal');
        document.getElementById('ideaTitle').value = '';
        document.getElementById('ideaContent').value = '';
      }
    }

    document.getElementById('commandInput').addEventListener('keypress', async (e) => {
      if (e.key === 'Enter') {
        const command = e.target.value.trim().toLowerCase();
        e.target.value = '';

        const doneMatch = command.match(/^(\d+)\s*done$/);
        if (doneMatch && currentData && currentData.activeTasks) {
          const index = parseInt(doneMatch[1]) - 1;
          if (index >= 0 && index < currentData.activeTasks.length) {
            const task = currentData.activeTasks[index];
            const checkbox = document.querySelector(`[data-id="${task.id}"] .task-checkbox`);
            if (checkbox) completeTask(task.id, checkbox);
          }
        }
      }
    });

    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`tab-${tabName}`).classList.add('active');
        if (tabName === 'launches') loadAllLaunches();
      });
    });

    function openAddTaskModal() { document.getElementById('addTaskModal').classList.add('show'); }
    function openJournalModal() { document.getElementById('journalModal').classList.add('show'); }
    function openIdeaModal() { document.getElementById('ideaModal').classList.add('show'); }
    function closeModal(id) { document.getElementById(id).classList.remove('show'); }

    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.classList.remove('show'); });
    });

    function saveSettings() {
      API_URL = document.getElementById('apiUrl').value.trim();
      localStorage.setItem('apiUrl', API_URL);
      showToast('Configuration saved');
    }

    function getTimeOfDay() {
      const hour = new Date().getHours();
      if (hour < 12) return 'Morning';
      if (hour < 17) return 'Afternoon';
      return 'Evening';
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }).toUpperCase();
    }

    function isOverdue(dateStr) {
      return new Date(dateStr) < new Date(new Date().toDateString());
    }

    function escapeHtml(str) {
      if (!str) return '';
      return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast show ${type}`;
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function refreshData() { loadMorningData(); }

    // Initialize
    if (!checkSession()) {
      // Focus first PIN input
      pinInputs[0].focus();
    }
  </script>

</body>
</html>
